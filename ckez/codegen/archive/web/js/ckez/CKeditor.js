delete CKEDITOR.focusManager._.blurDelay;ckez.CKeditor=zk.$extends(zul.Widget,{_height:"200",_value:"",$define:{value:[function(a){return !a?"":a},function(a){var b=this.getEditor();if(b){b.setData(a)}}],autoHeight:null,customConfigurationsPath:_zkf=function(){if(this.desktop){this.rerender()}},toolbar:_zkf,width:function(a){if(!a||!this.$n()){return}this._setSize(jq("#cke_"+this.uuid+"-cnt"),a,"width")},height:function(a){if(!a||!this.$n()){return}this._setSize(jq("#cke_"+this.uuid+"-cnt"),a,"height")}},setVflex:function(a){if(a=="min"){a=false}if(this._editor){this.$super(ckez.CKeditor,"setVflex",a)}else{this._tmpVflex=a}},setHflex:function(a){if(a=="min"){a=false}if(this._editor){this.$super(ckez.CKeditor,"setHflex",a)}else{this._tmpHflex=a}},setFlexSize_:function(c,b){if(this._editor){var d=this.$n(),a=zk(d);if(c.height!==undefined){if(c.height=="auto"){d.style.height=""}else{if(c.height!=""){this.setFlexSizeH_(d,a,c.height,b)}else{d.style.height=this._height||"";if(this._height){this._setSize(jq("#cke_"+this.uuid+"-cnt"),this._height,"height")}else{this._setSize(jq("#cke_"+this.uuid+"-cnt"),"200px","height")}}}}if(c.width!==undefined){if(c.width=="auto"){d.style.width=""}else{if(c.width!=""){this.setFlexSizeW_(d,a,c.width,b)}else{d.style.width=this._width||"";if(this._width){this._setSize(jq("#cke_"+this.uuid+"-cnt"),this._width,"width")}else{this._setSize(jq("#cke_"+this.uuid+"-cnt"),"100%","width")}}}}return{height:d.offsetHeight,width:d.offsetWidth}}},setFlexSizeH_:function(b,d,i,g){this._hflexHeight=i;this.$super(ckez.CKeditor,"setFlexSizeH_",b,d,i,g);var c=parseInt(b.style.height);b.style.height="";var a=jq("#cke_"+this.uuid+"-cnt"),e=a.get(0).parentNode,j=jq(e.previousSibling).outerHeight(),f=jq(e.nextSibling).outerHeight();c=c-j-f-25;this._setSize(a,jq.px0(c),"height")},setFlexSizeW_:function(f,a,d,c){var e=jq("#cke_"+this.uuid+"-cnt .cke_top").outerHeight();this.$super(ckez.CKeditor,"setFlexSizeW_",f,a,d,c);var b=parseInt(f.style.width);b=b-16;this._setSize(jq("#cke_"+this.uuid+"-cnt"),jq.px0(b),"width");if(e!=jq("#cke_"+this.uuid+"-cnt .cke_top").outerHeight()&&this._vflex){this.setFlexSizeH_(f,a,this._hflexHeight,c)}},redraw:function(a){a.push("<div",this.domAttrs_({domStyle:true}),'><textarea id="',this.uuid,'-cnt">',this._value,"</textarea></div>")},domAttrs_:function(b){var a=this.$supers("domAttrs_",arguments);if(!this.isVisible()&&(!b||!b.visible)){a+=' style="display:none;"'}return a},bind_:function(){this.$supers("bind_",arguments);var a=this;setTimeout(function(){a._init()},50);zWatch.listen({onSend:this});zWatch.listen({onRestore:this})},unbind_:function(){if(!this._editor){this._unbind=true;this._arguments=arguments;return}this._editor.destroy(true);this._unbind=this._editor=this._tmpVflex=this._tmpHflex=null;zWatch.unlisten({onSend:this});zWatch.unlisten({onRestore:this});this.$supers("unbind_",arguments)},onSend:function(c){var a=c.args[1];if(!a){var b=this.getEditor();if(b){this.$class.onBlur(b,true)}}},onRestore:function(){var a=jq("#cke_"+this.uuid+"-cnt iframe")[0];if(!a){return}CKEDITOR.remove(this._editor);jq(this.$n()).html('<textarea id="'+this.uuid+'-cnt">'+this._value+"</textarea>");this.clearCache();this._init();if(zk.ie){jq("#cke_"+this.uuid+"-cnt").width(jq("#cke_"+this.uuid+"-cnt").width())}},_setSize:function(a,b,c){b=this._getValue(b);if(!b){return}a[c](b);this._editor.config[c]=b},_getValue:function(a){if(!a){return null}if(a.endsWith("%")){return zk.ie?jq.px0(jq(this.$n()).width()):a}return jq.px0(zk.parseInt(a))},getEditor:function(){return this._editor},_init:function(){var m=this,a=this.uuid,d=this.desktop.id,e=this._customConfigurationsPath,b=this.filebrowserBrowseUrl,g=this.filebrowserImageBrowseUrl,k=this.filebrowserFlashBrowseUrl,h=this.filebrowserUploadUrl,j=this.filebrowserImageUploadUrl,l=this.filebrowserFlashUploadUrl,f=this.fileBrowserTempl,i=this.fileUploadTempl,c={customConfig:e,width:this._getValue(this._width),height:this._getValue(this._height)};if(b){c.filebrowserBrowseUrl=f+"?Type=Files&url="+b}if(g){c.filebrowserImageBrowseUrl=f+"?Type=Images&url="+g}if(k){c.filebrowserFlashBrowseUrl=f+"?Type=Flash&url="+k}if(h){c.filebrowserUploadUrl=i+"?Type=Files&url="+h+"&dtid="+d+"&uuid="+a}if(j){c.filebrowserImageUploadUrl=i+"?Type=Images&url="+j+"&dtid="+d+"&uuid="+a}if(l){c.filebrowserFlashUploadUrl=i+"?Type=Flash&url="+l+"&dtid="+d+"&uuid="+a}if(this._toolbar){c.toolbar=this._toolbar}jq(this.$n("cnt")).ckeditor(function(){if(m._unbind){this.destroy();m.unbind=m._editor=null;zWatch.unlisten({onSend:m});zWatch.unlisten({onRestore:m});m.$supers("unbind_",m._arguments);return}m._editor=this;this.on("focus",ckez.CKeditor.onFocus);this.on("blur",ckez.CKeditor.onBlur);this.on("selectionChange",ckez.CKeditor.onSelection);m._overrideFormSubmit();this.on("key",ckez.CKeditor.onAutoHeight);this.on("loadSnapshot",ckez.CKeditor.onAutoHeight);this.on("beforePaste",ckez.CKeditor.onAutoHeight);this.resetDirty();if(!m._tmpHflex&&m._hflex){m._tmpHflex=m._hflex;m.setHflex(null)}if(!m._tmpVflex&&m._vflex){m._tmpVflex=m._vflex;m.setVflex(null)}if(m._tmpHflex){m.setHflex(m._tmpHflex,{force:true});m._tmpHflex=null}if(m._tmpVflex){m.setVflex(m._tmpVflex,{force:true});m._tmpVflex=null}},c)},_overrideFormSubmit:function(){var b=this.getEditor(),d=zk.Widget.$(b.element.getId()),a=b.element,c=a.$.form&&new CKEDITOR.dom.element(a.$.form);if(!c){return}c.$.submit=CKEDITOR.tools.override(c.$.submit,function(e){return function(){b.updateElement();var f=b.getData();d.fire("onChange",{value:f},{sendAhead:true});d.fire("onSave",{value:f},{sendAhead:true})}})}},{onFocus:function(c){var b=c.editor,d=zk.Widget.$(b.element.getId()),a=b._.previousValue;d._tidChg=setInterval(function(){if(a!=b._.previousValue){a=d.previousValue=b._.previousValue}if(b.mayBeDirty&&d.previousValue!=b.getData()){d.fire("onChanging",{value:b.getData(),start:0,bySelectBack:false},{ignorable:1},100);if(b.mayBeDirty){d.previousValue=b.getData()}}},500)},onBlur:function(c,a){var b=c.editor?c.editor:c,e=zk.Widget.$(b.element.getId());if(e._tidChg){clearInterval(e._tidChg);e._tidChg=null}if(b.checkDirty()){var d=b.getData();e._value=d;e.fire("onChange",{value:d},{sendAhead:a?a:true});b.resetDirty()}},onSelection:function(c){var b=c.editor,d=zk.Widget.$(b.element.getId()),a=b.getSelection();if(!zk(d).isRealVisible){return}a=CKEDITOR.env.ie?a.getNative().createRange().text:a.getNative().toString();if(a==""){return}},onAutoHeight:function(e){var d=e.editor,g=zk.Widget.$(d.element.getId()),b=jq("#cke_"+g.uuid+"-cnt"),c=b.find("iframe"),a=c.contents().find("body"),f=zk.parseInt(d.config.height);if(g._autoHeight){setTimeout(function(){var h=zk.parseInt(a.find("P").css("marginBottom")),i=zk.parseInt(a.css("marginBottom"));b.height(a.height()+h+i);if(b.height()<f){b.height(f)}},20)}}});